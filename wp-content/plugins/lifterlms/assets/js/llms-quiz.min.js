!function(r){var t={$buttons:null,$container:null,$ui:null,attempt_key:null,current_question:0,total_questions:0,questions:{},validators:{},status:null,resumable:null,exiting_quiz:!1,bind:function(){var e=this;r("#llms_start_quiz").on("click",function(t){t.preventDefault(),e.start_quiz()}),r("#llms_resume_quiz").on("click",function(t){t.preventDefault(),e.resume_quiz()}),r(".llms-donut").each(function(){LLMS.Donut(r(this))}),r("#llms-quiz-attempt-select").on("change",function(){var t=r(this).val();t&&(window.location.href=t)}),r(window).on("beforeunload",function(){if(e.status&&!e.exiting_quiz)return LLMS.l10n.translate("Are you sure you wish to quit this quiz attempt?")}),r(window).on("unload",function(){e.status&&!e.resumable&&e.complete_quiz()}),r(document).on("llms-post-append-question",e.post_append_question),this.register_validator("content",this.validate),this.register_validator("choice",this.validate_choice),this.register_validator("picture_choice",this.validate_choice),this.register_validator("true_false",this.validate_choice)},add_error:function(t){this.$container.find(".llms-error").remove();var e=r('<p class="llms-error">'+t+'<a href="#"><i class="fa fa-times-circle" aria-hidden="true"></i></a></p>');e.on("click","a",function(t){t.preventDefault(),e.fadeOut("200"),setTimeout(function(){e.remove()},210)}),this.$container.append(e)},save_question:function(e){var t=this.$container.find(".llms-question-wrapper"),i=t.attr("data-type");this.validators[i]?(t={action:"quiz_answer_question",answer:this.validators[i](t).answer,attempt_key:this.attempt_key,question_id:t.attr("data-id"),question_type:t.attr("data-type")},e&&e.exit_quiz&&(t.via_exit_quiz=!0),e&&e.previous_question&&(t.via_previous_question=!0),LLMS.Ajax.call({data:t,success:function(t){e&&"function"==typeof e.callback&&e.callback()}})):console.log("No validator registered for question type "+i)},answer_question:function(e){var t,s=this,i=this.$container.find(".llms-question-wrapper"),n=i.attr("data-type");if(this.validators[n]){if(!(t=this.validators[n](i))||!0!==t.valid||!t.answer)return s.add_error(t.valid);LLMS.Ajax.call({data:{action:"quiz_answer_question",answer:t.answer,attempt_key:s.attempt_key,question_id:i.attr("data-id"),question_type:i.attr("data-type")},beforeSend:function(){var t=e.hasClass("llms-button-quiz-complete")?LLMS.l10n.translate("Grading Quiz..."):LLMS.l10n.translate("Loading Question...");s.toggle_loader("show",t),s.update_progress_bar("increment")},success:function(t){s.toggle_loader("hide"),t.data&&t.data.html?t.data.question_id&&s.questions["q-"+t.data.question_id]?s.load_question(s.questions["q-"+t.data.question_id]):s.load_question(t.data.html):t.data&&t.data.redirect?s.redirect(t.data.redirect):t.message?s.$container.append("<p>"+t.message+"</p>"):(t=LLMS.l10n.translate("An unknown error occurred. Please try again."),s.$container.append("<p>"+t+"</p>"))},error:function(t,e,i){s.reload_question(),s.add_error(LLMS.l10n.translate("An unknown error occurred. Please try again.")),console.log(i)}})}else console.log("No validator registered for question type "+n)},complete_quiz:function(){var e=this;LLMS.Ajax.call({data:{action:"quiz_end",attempt_key:e.attempt_key},beforeSend:function(){e.toggle_loader("show","Grading Quiz...")},success:function(t){e.toggle_loader("hide"),t.data&&t.data.redirect?e.redirect(t.data.redirect):t.message?e.$container.append("<p>"+t.message+"</p>"):(t=LLMS.l10n.translate("An unknown error occurred. Please try again."),e.$container.append("<p>"+t+"</p>"))}})},get_question_index:function(t){return Object.keys(this.questions).indexOf("q-"+t)},redirect:function(t){this.toggle_loader("show","Grading Quiz..."),this.status=null,window.location.href=t},reload_question:function(){var t=this;t.toggle_loader("show",LLMS.l10n.translate("Loading Question...")),t.update_progress_bar("reload"),setTimeout(function(){t.toggle_loader("hide"),t.load_question(t.questions["q-"+t.current_question])},100)},previous_question:function(){var s=this;this.save_question({previous_question:!0,callback:function(){s.toggle_loader("show",LLMS.l10n.translate("Loading Question...")),s.update_progress_bar("decrement");var t=Object.keys(s.questions),e=t.indexOf("q-"+s.current_question),i=t[0];1<=e&&(i=t[e-1]),s.questions[i]?setTimeout(function(){s.toggle_loader("hide"),s.load_question(s.questions[i])},100):LLMS.Ajax.call({data:{action:"quiz_get_question",attempt_key:s.attempt_key,question_id:i.substring(2)},success:function(t){s.toggle_loader("hide"),t.data&&t.data.html?s.load_question(t.data.html):t.data&&t.data.redirect?s.redirect(t.data.redirect):t.message?s.$container.append("<p>"+t.message+"</p>"):(t=LLMS.l10n.translate("An unknown error occurred. Please try again."),s.$container.append("<p>"+t+"</p>"))}})}})},register_validator:function(t,e){this.validators[t]=e},start_quiz:function(){this.init_quiz("quiz_start")},resume_quiz:function(){this.init_quiz("quiz_resume")},init_quiz:function(e){var i=this;"quiz_resume"===e&&r("#llms_resume_quiz").attr("disabled","disabled"),this.load_ui_elements(),this.$ui=r("#llms-quiz-ui"),this.$buttons=r("#llms-quiz-nav button"),this.$container=r("#llms-quiz-question-wrapper"),r("#llms-next-question, #llms-complete-quiz").on("click",function(t){t.preventDefault(),i.answer_question(r(this))}),r("#llms-prev-question").on("click",function(t){t.preventDefault(),i.previous_question()}),r("#llms-quiz-nav").on("click","#llms-exit-quiz",function(t){t.preventDefault(),i.save_question({exit_quiz:!0,callback:function(){i.exiting_quiz=!0,window.location.reload()}})}),data="quiz_resume"===e?{action:"quiz_resume",attempt_key:r("#llms-attempt-key").val()}:{action:"quiz_start",attempt_key:r("#llms-attempt-key").val(),lesson_id:r("#llms-lesson-id").val(),quiz_id:r("#llms-quiz-id").val()},LLMS.Ajax.call({data:data,beforeSend:function(){i.status=!0,r("#llms-quiz-wrapper, #quiz-start-button, #quiz-resume-button").remove(),r("html, body").stop().animate({scrollTop:0},500),i.toggle_loader("show",LLMS.l10n.translate("Loading Quiz..."))},error:function(t,e,i){console.log(t,e,i)},success:function(t){i.toggle_loader("hide"),t.data&&t.data.html?(i.attempt_key=t.data.attempt_key,i.total_questions=t.data.total,i.resumable=t.data.can_be_resumed,"quiz_resume"===e?t.data.question_ids.forEach(t=>i.questions["q-"+t]=""):t.data.time_limit&&i.start_quiz_timer(t.data.time_limit),i.resumable&&r("#llms-quiz-nav").append('<button class="button llms-button-secondary" id="llms-exit-quiz" name="llms_exit_quiz">'+LLMS.l10n.translate("Exit Quiz")+"</button>"),i.load_question(t.data.html),"quiz_resume"===e&&i.update_progress_bar("reload")):t.message?i.$container.append("<p>"+t.message+"</p>"):(t=LLMS.l10n.translate("An unknown error occurred. Please try again."),i.$container.append("<p>"+t+"</p>"))}}),LLMS.is_touch_device()||(this.$ui.on("mouseenter","li.llms-choice label",function(){r(this).addClass("hovered")}),this.$ui.on("mouseleave","li.llms-choice label",function(){r(this).removeClass("hovered")}))},start_quiz_timer:function(t){var e=r('<div class="llms-quiz-timer" id="llms-quiz-timer" />'),i=LLMS.l10n.translate("Time Remaining"),s=(e.append('<i class="fa fa-clock-o" aria-hidden="true"></i><span class="screen-reader-text">'+i+"</span>"),e.append('<div id="llms-tiles" class="llms-tiles"></div>'),r("#llms-quiz-header").append(e),this),n=(new Date).getTime()+60*t*1e3,a=60*t*1e3,o=document.getElementById("llms-tiles");setTimeout(function(){s.complete_quiz()},1e3+a),this.getCountdown(t,n,a,void 0,void 0,void 0,void 0,o),setInterval(function(){s.getCountdown(t,n,a,void 0,void 0,void 0,void 0,o)},1e3)},trigger:function(t){"answer_question"===t&&(this.get_question_index(this.current_question)===this.total_questions?r("#llms-complete-quiz"):r("#llms-next-question")).trigger("click")},load_question:function(t){var t=r(t),e=t.attr("data-id");this.questions["q-"+e]||(this.questions["q-"+e]=t),this.update_progress(e),this.current_question=e,r(document).trigger("llms-pre-append-question",t),this.$container.append(t),r(document).trigger("llms-post-append-question",t)},load_ui_elements:function(){0<r("#llms-quiz-ui").length&&r("#llms-quiz-ui").remove();var t=r('<div class="llms-quiz-ui" id="llms-quiz-ui" />'),e=r('<header class="llms-quiz-header" id="llms-quiz-header" />');($footer=r('<footer class="llms-quiz-nav" id="llms-quiz-nav" />')).append('<button class="button large llms-button-action" id="llms-next-question" name="llms_next_question" type="submit">'+LLMS.l10n.translate("Next Question")+"</button>"),$footer.append('<button class="button large llms-button-action llms-button-quiz-complete" id="llms-complete-quiz" name="llms_complete_quiz" type="submit" style="display:none;">'+LLMS.l10n.translate("Complete Quiz")+"</button>"),$footer.append('<button class="button llms-button-secondary" id="llms-prev-question" name="llms_prev_question" type="submit" style="display:none;">'+LLMS.l10n.translate("Previous Question")+"</button>"),e.append('<div class="llms-progress"><div class="progress-bar-complete"></div></div>'),$footer.append('<div class="llms-quiz-counter" id="llms-quiz-counter"><span class="llms-current"></span><span class="llms-sep">/</span><span class="llms-total"></span></div>'),t.append(e).append('<div class="llms-quiz-question-wrapper" id="llms-quiz-question-wrapper" />').append($footer),r("#llms-quiz-wrapper").after(t)},post_append_question:function(t,e){r(e).find("audio").length&&wp.mediaelement.initialize()},toggle_loader:function(t,e){"show"===t?(e=e||LLMS.l10n.translate("Loading..."),this.$buttons.attr("disabled","disabled"),this.$container.empty(),LLMS.Spinner.start(this.$container),this.$container.append('<div class="llms-quiz-loading">'+LLMS.l10n.translate(e)+"</div>")):(LLMS.Spinner.stop(this.$container),this.$buttons.removeAttr("disabled"),this.$container.find(".llms-quiz-loading").remove())},update_progress:function(t){t=this.get_question_index(t);-1!==t&&(t++,r("#llms-quiz-counter .llms-current").text(t),0<t&&!r("#llms-quiz-counter .llms-total").text()&&(r("#llms-quiz-counter .llms-total").text(this.total_questions),r("#llms-quiz-counter").show()),2<=t?r("#llms-prev-question").show():r("#llms-prev-question").hide(),t===this.total_questions?(r("#llms-next-question").hide(),r("#llms-complete-quiz").show()):(r("#llms-next-question").show(),r("#llms-complete-quiz").hide()))},update_progress_bar:function(t){var e=this.get_question_index(this.current_question);switch(t){case"increment":e++;break;case"decrement":e--}progress=e/this.total_questions*100,this.$ui.find(".progress-bar-complete").css("width",progress+"%")},getCountdown:function(t,e,i,s,n,a,o,l){e=(e-(new Date).getTime())/1e3;0<=e&&(1e3*e<i/2&&r("#llms-quiz-timer").addClass("color-half"),1e3*e<i/4&&(r("#llms-quiz-timer").removeClass("color-half"),r("#llms-quiz-timer").addClass("color-empty")),this.pad(parseInt(e/86400)),e%=86400,n=this.pad(parseInt(e/3600)),e%=3600,a=this.pad(parseInt(e/60)),o=this.pad(parseInt(e%60)),l.innerHTML='<span class="hours">'+n+'</span>:<span class="minutes">'+a+'</span>:<span class="seconds">'+o+"</span>")},pad:function(t){return(t<10?"0":"")+t},validate:function(t){return{answer:[],valid:!0}},validate_choice:function(t){var e=window.llms.quizzes.validate(t),t=t.find("input:checked");return t.length?t.each(function(){e.answer.push(r(this).val())}):e.valid=LLMS.l10n.translate("You must select an answer to continue."),e}};t.bind(),window.llms=window.llms||{},window.llms.quizzes=t}(jQuery);
//# sourceMappingURL=../maps/js/llms-quiz.min.js.map
