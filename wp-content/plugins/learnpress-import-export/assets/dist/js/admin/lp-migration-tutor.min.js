(()=>{"use strict";window.wp.url;let e,t,r,o,i,s,l,a,c,n,d,u,m,L,p,v,g,_,y,q,h,C,S,T=document.querySelector(".lp-migration-wrapper .content.tutor");const M=document.querySelectorAll(".migrate-item .migrate-item-checkbox"),f=LP_ADDON_IMPORT_EXPORT_GLOBAL_OBJECT?.rest_namespace||"",w=parseInt(LP_ADDON_IMPORT_EXPORT_GLOBAL_OBJECT?.tutor_course_total)||0,H=parseInt(LP_ADDON_IMPORT_EXPORT_GLOBAL_OBJECT?.tutor_section_total)||0,O=parseInt(LP_ADDON_IMPORT_EXPORT_GLOBAL_OBJECT?.tutor_course_item_total)||0,x=parseInt(LP_ADDON_IMPORT_EXPORT_GLOBAL_OBJECT?.tutor_question_total)||0,E=parseInt(LP_ADDON_IMPORT_EXPORT_GLOBAL_OBJECT?.tutor_course_process_total)||0,b=document.querySelector("#lp-before-migrate-popup"),k=document.querySelector("#lp-clear-migrated-data-popup"),P=document.querySelector("#lp-migrate-success-popup"),A=document.querySelector("body"),D=document.querySelector("#migration-report"),B=()=>{o.style.width="0%",r.innerHTML="0",l.style.width="0%",s.innerHTML="0",n.style.width="0%",c.innerHTML="0",m.style.width="0%",u.innerHTML="0",v.style.width="0%",p.innerHTML=0,[...M].map((e=>{e.innerHTML=Z}))},R=()=>{e.innerHTML="",e.classList.remove("lp-migration-success"),e.classList.remove("lp-migration-error")},I='\n\t\t<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M8 1.33333C4.3181 1.33333 1.33333 4.3181 1.33333 8C1.33333 11.6819 4.3181 14.6667 8 14.6667C11.6819 14.6667 14.6667 11.6819 14.6667 8C14.6667 4.3181 11.6819 1.33333 8 1.33333ZM0 8C0 3.58172 3.58172 0 8 0C12.4183 0 16 3.58172 16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8Z" fill="#34C759"/>\n\t\t<path d="M11.0685 5.4759L7.54764 9.62136L5.58892 7.66984C5.37262 7.45166 5.03615 7.4759 4.81985 7.66984C4.60355 7.88802 4.62758 8.22742 4.81985 8.4456L7.01891 10.6153C7.16311 10.7608 7.35538 10.8335 7.54764 10.8335C7.73991 10.8335 7.93218 10.7608 8.07638 10.6153L11.8376 6.2759C12.0539 6.05772 12.0539 5.71833 11.8376 5.50014C11.6213 5.28196 11.2848 5.28196 11.0685 5.4759Z" fill="#34C759"/>\n\t',Z='\n\t\t<svg width="16" height="17" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t<path d="M8 1.83333C4.3181 1.83333 1.33333 4.8181 1.33333 8.5C1.33333 12.1819 4.3181 15.1667 8 15.1667C11.6819 15.1667 14.6667 12.1819 14.6667 8.5C14.6667 4.8181 11.6819 1.83333 8 1.83333ZM0 8.5C0 4.08172 3.58172 0.5 8 0.5C12.4183 0.5 16 4.08172 16 8.5C16 12.9183 12.4183 16.5 8 16.5C3.58172 16.5 0 12.9183 0 8.5Z" fill="#8A8888"></path>\n\t\t<path d="M11.0688 5.9759L7.54789 10.1214L5.58916 8.16984C5.37286 7.95166 5.03639 7.9759 4.82009 8.16984C4.60379 8.38802 4.62783 8.72742 4.82009 8.9456L7.01915 11.1153C7.16335 11.2608 7.35562 11.3335 7.54789 11.3335C7.74016 11.3335 7.93242 11.2608 8.07662 11.1153L11.8379 6.7759C12.0542 6.55772 12.0542 6.21833 11.8379 6.00014C11.6216 5.78196 11.2851 5.78196 11.0688 5.9759Z" fill="#8A8888"></path>\n\t\t</svg>',F='\n\t\t<svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M8.00016 3.16669C8.36835 3.16669 8.66683 3.46516 8.66683 3.83335V13.1667C8.66683 13.5349 8.36835 13.8334 8.00016 13.8334C7.63197 13.8334 7.3335 13.5349 7.3335 13.1667V3.83335C7.3335 3.46516 7.63197 3.16669 8.00016 3.16669Z" fill="#787C82"/>\n\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M2.6665 8.49998C2.6665 8.13179 2.96498 7.83331 3.33317 7.83331H12.6665C13.0347 7.83331 13.3332 8.13179 13.3332 8.49998C13.3332 8.86817 13.0347 9.16665 12.6665 9.16665H3.33317C2.96498 9.16665 2.6665 8.86817 2.6665 8.49998Z" fill="#787C82"/>\n\t\t</svg>',N='\n\t\t<svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M2.6665 8.49998C2.6665 8.13179 2.96498 7.83331 3.33317 7.83331H12.6665C13.0347 7.83331 13.3332 8.13179 13.3332 8.49998C13.3332 8.86817 13.0347 9.16665 12.6665 9.16665H3.33317C2.96498 9.16665 2.6665 8.86817 2.6665 8.49998Z" fill="#787C82"/>\n\t\t</svg>',G=(t=1,i="course")=>{(e=>{"course"!==e||y.querySelector(".loader")||(y.innerHTML='<div class="loader">'),"section"!==e||q.querySelector(".loader")||(q.innerHTML='<div class="loader">'),"course_item"!==e||h.querySelector(".loader")||(h.innerHTML='<div class="loader">'),"question"!==e||C.querySelector(".loader")||(C.innerHTML='<div class="loader">')})(i),wp.apiFetch({path:"/"+f+"/migrate/tutor",method:"POST",data:{paged:t,number:50,item:i}}).then((t=>{if(t.status&&"success"===t.status){if("course"===i){const e=t?.data?.migrated_course_total,i=(e/w*100).toFixed(0);o.style.width=`${i}%`,r.innerHTML=e,t?.data?.next_migrate_item&&"course"!==t?.data?.next_migrate&&(y.innerHTML=I)}if("section"===i){const e=t?.data?.migrated_section_total,r=(e/H*100).toFixed(0);l.style.width=`${r}%`,s.innerHTML=e,t?.data?.next_migrate_item&&"section"!==t?.data?.next_migrate_item&&(q.innerHTML=I)}if("course_item"===i){const e=t?.data?.migrated_course_item_total,r=(e/O*100).toFixed(0);n.style.width=`${r}%`,c.innerHTML=e,t?.data?.next_migrate_item&&"course_item"!==t?.data?.next_migrate_item&&(h.innerHTML=I)}if("question"===i){const e=t?.data?.migrated_question_total,r=(e/x*100).toFixed(0);m.style.width=`${r}%`,u.innerHTML=e,t?.data?.next_migrate_item&&"question"!==t?.data?.next_migrate_item&&(C.innerHTML=I)}if("course_process"===i){const e=t?.data?.migrated_course_process_total,r=(e/E*100).toFixed(0);v.style.width=`${r}%`,p.innerHTML=e,!1===t?.data?.next_migrate_item&&(S.innerHTML=I)}t?.data?.next_migrate_item?G(t?.data?.next_page,t?.data?.next_migrate_item):(e.innerHTML=t.msg,e.classList.add("lp-migration-success"),_.disabled=!1,setTimeout((()=>{J(t.data)}),1e3))}else e.innerHTML=t.msg,e.classList.add("lp-migration-error")})).catch((e=>{console.log(e)})).finally((()=>{}))},J=e=>{P&&(P.querySelector(".migrate-result").innerHTML=e.migrate_success_html,P.classList.add("active"),A.classList.add("lp-no-scroll"))},X=()=>{T&&(g=T.querySelector("#lp-auto-migrate-btn.tutor"),_=T.querySelector("#lp-clear-migrate-btn"),e=T.querySelector(".status"),t=T.querySelector(".course"),o=t.querySelector(".progress-bar"),r=t.querySelector(".migrated-course-total"),y=t.querySelector(".migrate-item-checkbox"),i=T.querySelector(".section"),l=i.querySelector(".progress-bar"),s=i.querySelector(".migrated-section-total"),q=i.querySelector(".migrate-item-checkbox"),a=T.querySelector(".course-item"),n=a.querySelector(".progress-bar"),c=a.querySelector(".migrated-course-item-total"),h=a.querySelector(".migrate-item-checkbox"),d=T.querySelector(".question"),m=d.querySelector(".progress-bar"),u=d.querySelector(".migrated-question-total"),C=d.querySelector(".migrate-item-checkbox"),L=T.querySelector(".course-process"),v=L.querySelector(".progress-bar"),p=L.querySelector(".migrated-process-course-total"),S=L.querySelector(".migrate-item-checkbox"),(()=>{if(!g||!b)return;g.addEventListener("click",(function(){b.classList.add("active"),A.classList.add("lp-no-scroll")}));const e=b.querySelector("button.cancel"),t=b.querySelector("a.remove-popup"),r=b.querySelector(".bg-overlay"),o=b.querySelector("button.migrate-now");e.addEventListener("click",(function(){b.classList.remove("active"),A.classList.remove("lp-no-scroll")})),t.addEventListener("click",(function(){b.classList.remove("active"),A.classList.remove("lp-no-scroll")})),r.addEventListener("click",(function(){b.classList.remove("active"),A.classList.remove("lp-no-scroll")})),o.addEventListener("click",(function(){b.classList.remove("active"),g.disabled=!0,B(),R(),A.classList.remove("lp-no-scroll"),G()}))})(),P&&(P.querySelector("a.remove-popup").addEventListener("click",(function(){P.classList.remove("active"),A.classList.remove("lp-no-scroll")})),P.querySelector(".bg-overlay").addEventListener("click",(function(){P.classList.remove("active"),A.classList.remove("lp-no-scroll")})),P.querySelector(".view-report").addEventListener("click",(function(e){e.preventDefault(),P.classList.remove("active"),A.classList.remove("lp-no-scroll"),window.location.reload()}))),(()=>{if(!_||!k)return;_.addEventListener("click",(function(){k.classList.add("active"),A.classList.add("lp-no-scroll")}));const t=k.querySelector("button.cancel"),r=k.querySelector("a.remove-popup"),o=k.querySelector(".bg-overlay"),i=k.querySelector("button.clear-migrated");t.addEventListener("click",(function(){k.classList.remove("active"),A.classList.remove("lp-no-scroll")})),r.addEventListener("click",(function(){k.classList.remove("active"),A.classList.remove("lp-no-scroll")})),o.addEventListener("click",(function(){k.classList.remove("active"),A.classList.remove("lp-no-scroll")})),i.addEventListener("click",(function(t){t.preventDefault(),k.classList.remove("active"),_.disabled=!0,[...M].map((e=>{e.innerHTML='<div class="loader">'})),wp.apiFetch({path:"/"+f+"/delete-migrated-data/tutor",method:"DELETE"}).then((t=>{t.status&&"success"===t.status?(e.innerHTML=t.msg,e.classList.remove("lp-migration-error"),e.classList.add("lp-migration-success"),t?.data?.tutor_course_total&&(g.disabled=!1),D&&D.remove(),B()):(e.innerHTML=t.msg,e.classList.add("lp-migration-error"))})).catch((e=>{console.log(e)})).finally((()=>{}))}))})(),(()=>{const e=document.querySelector("#migration-report");e&&[...e.querySelectorAll(".course-item")].map((e=>{const t=e.querySelector("header");t&&t.addEventListener("click",(function(r){if("A"===r.target.tagName)return;const o=t.querySelector(".header-icon");e.classList.contains("active")?o.innerHTML=F:o.innerHTML=N,e.classList.toggle("active")}))}))})())};document.addEventListener("DOMContentLoaded",(e=>{X()}))})();